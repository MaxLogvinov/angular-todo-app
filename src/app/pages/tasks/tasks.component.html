<div class="tasks-page">
  <header class="page-header">
    <h1>üìù –ú–æ–∏ –∑–∞–¥–∞—á–∏</h1>
    <div class="stats">
      <span>–í—Å–µ–≥–æ: {{ taskService.stats().total }}</span>
      <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ: {{ taskService.stats().completed }}</span>
      <span>–í —Ä–∞–±–æ—Ç–µ: {{ taskService.stats().pending }}</span>
    </div>
  </header>

  <div class="actions">
    <p-button label="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É" icon="pi pi-plus" (click)="openForm()" />
  </div>

  <p-table
    [value]="taskService.tasks()"
    styleClass="p-datatable-striped"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
        <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-task>
      <tr [class.completed-row]="task.completed">
        <td>
          <p-button
            [icon]="task.completed ? 'pi pi-check-circle' : 'pi pi-circle'"
            [rounded]="true"
            [text]="true"
            [severity]="task.completed ? 'success' : 'secondary'"
            (click)="toggleComplete(task.id)"
          />
        </td>
        <td [class.completed-text]="task.completed">
          {{ task.title }}
        </td>
        <td>
          <a [routerLink]="['/categories', task.category]" class="category-link">
            {{ task.category | categoryLabel }}
          </a>
        </td>
        <td>
          <p-tag
            [value]="task.priority | priorityLabel"
            [severity]="task.priority | prioritySeverity"
          />
        </td>
        <td>{{ task.createdAt | date: 'dd.MM.yyyy HH:mm' }}</td>
        <td>
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [text]="true"
            severity="danger"
            (click)="deleteTask(task.id)"
          />
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="empty-message">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é! üöÄ</td>
      </tr>
    </ng-template>
  </p-table>

  <app-task-form (taskCreated)="onTaskCreated($event)" />
</div>
